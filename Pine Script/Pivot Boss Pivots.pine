//@version=4
// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© pranjalchaubey

// Credits 
//==============================================================================
// A large amount of code in this indicator was taken from Legendary Chris Moody's
// "CM_Pivot Points_M-W-D_4H_1H_Filtered" Indicator
//==============================================================================


//Structural Pivots
study(title="[CP]Pivot Boss Floor Pivots & Camarilla - Smart Assist and DPZ Detection", shorttitle="[CP]Pivot Boss Pivots", overlay=true, max_labels_count=500)


// User Inputs 
//==============================================================================
show_floor_pivots       = input(true,   type=input.bool,                            title="Show Floor Pivots")
show_cpr                = input(true,   type=input.bool,                            title="Show Central Pivot Range")
show_smart_assist       = input(true,   type=input.bool,                            title="Show Smart Assist for Floor Pivots")

show_cams               = input(true,   type=input.bool,                            title="Show Camarilla Pivots")
show_hidden_cams        = input(false,  type=input.bool,                            title="Show Hidden Camarilla Layers H1 H2 L1 L2")

dynamic_pivot_levels    = input(true,   type=input.bool,                            title="Show Pivot Levels Dynamically")

show_dpz                = input(true,   type=input.bool,                            title="Mark Double Hot Pivot Zones (DPZ)")
atr_threshold           = input(1.0,    type=input.float,   minval=0.1, maxval=10,  title="ATR Threshold for DPZ Detection")
atr_period              = input(14,     type=input.integer,   minval=1, maxval=356, title="ATR Period")

show_daily_pivots       = input(true,   type=input.bool,                            title="Show Daily Pivots")
show_weekly_pivots      = input(false,  type=input.bool,                            title="Show Weekly Pivots")
show_monthly_pivots     = input(false,  type=input.bool,                            title="Show Monthly Pivots")
show_yearly_pivots      = input(false,  type=input.bool,                            title="Show Yearly Pivots")


// Calculations  
//==============================================================================
// Floor Pivots 
// Central Pivot 
pivot = (high + low + close) / 3.0
// Resistance Levels 
r1 = (2 * pivot) - low
r2 = pivot + (high - low)
r3 = r1 + (high - low)
r4 = r3 + (r2 - r1) 
// Support Levels 
s1 = (2 * pivot) - high  
s2 = pivot - (high - low) 
s3 = s1 - (high - low) 
s4 = s3 - (s1 - s2)
// Central Pivot Range 
temp_bc = (high + low) / 2 
temp_tc = (pivot - temp_bc) + pivot 
tc = temp_tc > temp_bc ? temp_tc : temp_bc
bc = temp_bc < temp_tc ? temp_bc : temp_tc
// The Camarilla Equation 
cam_range = high - low 
// Resistance Levels 
h1 = close + (cam_range * 1.1/12) 
h2 = close + (cam_range * 1.1/6) 
h3 = close + (cam_range * 1.1/4) 
h4 = close + (cam_range * 1.1/2)
h5 = (high / low) * close 
// Support Levels 
l1 = close - (cam_range * 1.1/12)
l2 = close - (cam_range * 1.1/6)
l3 = close - (cam_range * 1.1/4)
l4 = close - (cam_range * 1.1/2)
l5 = close - (h5 - close)
// Average True Range 
dpz_atr = atr(atr_period) * atr_threshold

// Daily Floor Pivots 
daily_pivot = security(syminfo.tickerid, 'D', pivot[1], barmerge.gaps_off, barmerge.lookahead_on)
daily_r1    = security(syminfo.tickerid, 'D', r1[1],    barmerge.gaps_off, barmerge.lookahead_on) 
daily_r2    = security(syminfo.tickerid, 'D', r2[1],    barmerge.gaps_off, barmerge.lookahead_on) 
daily_r3    = security(syminfo.tickerid, 'D', r3[1],    barmerge.gaps_off, barmerge.lookahead_on) 
daily_r4    = security(syminfo.tickerid, 'D', r4[1],    barmerge.gaps_off, barmerge.lookahead_on) 
daily_s1    = security(syminfo.tickerid, 'D', s1[1],    barmerge.gaps_off, barmerge.lookahead_on) 
daily_s2    = security(syminfo.tickerid, 'D', s2[1],    barmerge.gaps_off, barmerge.lookahead_on)
daily_s3    = security(syminfo.tickerid, 'D', s3[1],    barmerge.gaps_off, barmerge.lookahead_on)
daily_s4    = security(syminfo.tickerid, 'D', s4[1],    barmerge.gaps_off, barmerge.lookahead_on)
daily_tbc   = security(syminfo.tickerid, 'D', temp_bc,  barmerge.gaps_off, barmerge.lookahead_on)
daily_ttc   = security(syminfo.tickerid, 'D', temp_tc,  barmerge.gaps_off, barmerge.lookahead_on)
daily_tc    = daily_ttc > daily_tbc ? daily_ttc : daily_tbc
daily_bc    = daily_tbc < daily_ttc ? daily_tbc : daily_ttc

// Daily Camarilla Pivots 
daily_h1    = security(syminfo.tickerid, 'D', h1[1], barmerge.gaps_off, barmerge.lookahead_on)
daily_h2    = security(syminfo.tickerid, 'D', h2[1], barmerge.gaps_off, barmerge.lookahead_on)
daily_h3    = security(syminfo.tickerid, 'D', h3[1], barmerge.gaps_off, barmerge.lookahead_on)
daily_h4    = security(syminfo.tickerid, 'D', h4[1], barmerge.gaps_off, barmerge.lookahead_on)
daily_h5    = security(syminfo.tickerid, 'D', h5[1], barmerge.gaps_off, barmerge.lookahead_on)
daily_l1    = security(syminfo.tickerid, 'D', l1[1], barmerge.gaps_off, barmerge.lookahead_on)
daily_l2    = security(syminfo.tickerid, 'D', l2[1], barmerge.gaps_off, barmerge.lookahead_on)
daily_l3    = security(syminfo.tickerid, 'D', l3[1], barmerge.gaps_off, barmerge.lookahead_on)
daily_l4    = security(syminfo.tickerid, 'D', l4[1], barmerge.gaps_off, barmerge.lookahead_on)
daily_l5    = security(syminfo.tickerid, 'D', l5[1], barmerge.gaps_off, barmerge.lookahead_on)

// Daily Average True Range 
daily_dpz_atr = security(syminfo.tickerid, 'D', dpz_atr[1], barmerge.gaps_off, barmerge.lookahead_on)


// Plots   
//==============================================================================
plot(show_floor_pivots and show_daily_pivots ? daily_pivot : na, color = color.blue, linewidth = 2, style = plot.style_line, transp = 0)
// plot(islast ? r1 : na, title = "R1", color = color.red, linewidth = 1, style = linestyle, transp = 0)
// plot(islast ? r2 : na, title = "R2", color = color.red, linewidth = 1, style = linestyle, transp = 0)
// plot(islast ? r3 : na, title = "R3", color = color.red, linewidth = 1, style = linestyle, transp = 0)
// plot(islast ? r4 : na, title = "R4", color = color.red, linewidth = 1, style = linestyle, transp = 0)
// plot(islast ? s1 : na, title = "S1", color = color.lime, linewidth = 1, style = linestyle, transp = 0)
// plot(islast ? s2 : na, title = "S2", color = color.lime, linewidth = 1, style = linestyle, transp = 0)
// plot(islast ? s3 : na, title = "S3", color = color.lime, linewidth = 1, style = linestyle, transp = 0)
// plot(islast ? s4 : na, title = "S4", color = color.lime, linewidth = 1, style = linestyle, transp = 0)
// tcline = plot(islast ? tc : na, title = "TC", color = color.blue, linewidth = 1, style = plot.style_line, transp = 50)
// bcline = plot(islast ? bc : na, title = "BC", color = color.blue, linewidth = 1, style = plot.style_line, transp = 50)
// fill(tcline, bcline, color = color.blue, transp = 70)
